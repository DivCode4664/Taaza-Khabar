name: Check Unit Tests in Pull Request

on:
  pull_request:
    types:
      - opened
      - synchronize

jobs:
  check-tests:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: List Changed Files
        id: list_files
        run: |
          # Get the list of changed files between the current commit and the base commit
          CHANGED_FILES=$(git diff --name-only ${{ github.base_ref }} ${{ github.sha }})

          # Set the output variable for later steps
          echo "::set-output name=files::${CHANGED_FILES}"

      - name: Check for Test Files
        run: |
          # Retrieve the list of changed files from the previous step
          CHANGED_FILES="${{ steps.list_files.outputs.files }}"

          # Check if any test files are present in the changed files
          if echo "$CHANGED_FILES" | grep -E '.*Test.*|.*Spec.*'; then
            echo "Test files exist!"
          else
            echo "Error: Pull request must include at least one test file."
            exit 1
          fi
